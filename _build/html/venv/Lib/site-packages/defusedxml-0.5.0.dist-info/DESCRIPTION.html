
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>defusedxml – defusing XML bombs and other exploits &#8212; bme590hrm 1.0.2 documentation</title>
    <link rel="stylesheet" href="../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="defusedxml-defusing-xml-bombs-and-other-exploits">
<h1><a class="toc-backref" href="#id3">defusedxml – defusing XML bombs and other exploits</a><a class="headerlink" href="#defusedxml-defusing-xml-bombs-and-other-exploits" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div>“It’s just XML, what could probably go wrong?”</div></blockquote>
<p>Christian Heimes &lt;<a class="reference external" href="mailto:christian&#37;&#52;&#48;python&#46;org">christian<span>&#64;</span>python<span>&#46;</span>org</a>&gt;</p>
<div class="section" id="synopsis">
<h2><a class="toc-backref" href="#id4">Synopsis</a><a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<p>The results of an attack on a vulnerable XML library can be fairly dramatic.
With just a few hundred <strong>Bytes</strong> of XML data an attacker can occupy several
<strong>Gigabytes</strong> of memory within <strong>seconds</strong>. An attacker can also keep
CPUs busy for a long time with a small to medium size request. Under some
circumstances it is even possible to access local files on your
server, to circumvent a firewall, or to abuse services to rebound attacks to
third parties.</p>
<p>The attacks use and abuse less common features of XML and its parsers. The
majority of developers are unacquainted with features such as processing
instructions and entity expansions that XML inherited from SGML. At best
they know about <code class="docutils literal notranslate"><span class="pre">&lt;!DOCTYPE&gt;</span></code> from experience with HTML but they are not
aware that a document type definition (DTD) can generate an HTTP request
or load a file from the file system.</p>
<p>None of the issues is new. They have been known for a long time. Billion
laughs was first reported in 2003. Nevertheless some XML libraries and
applications are still vulnerable and even heavy users of XML are
surprised by these features. It’s hard to say whom to blame for the
situation. It’s too short sighted to shift all blame on XML parsers and
XML libraries for using insecure default settings. After all they
properly implement XML specifications. Application developers must not rely
that a library is always configured for security and potential harmful data
by default.</p>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#defusedxml-defusing-xml-bombs-and-other-exploits" id="id3">defusedxml – defusing XML bombs and other exploits</a><ul>
<li><a class="reference internal" href="#synopsis" id="id4">Synopsis</a></li>
<li><a class="reference internal" href="#attack-vectors" id="id5">Attack vectors</a></li>
<li><a class="reference internal" href="#python-xml-libraries" id="id6">Python XML Libraries</a></li>
<li><a class="reference internal" href="#defusedxml" id="id7">defusedxml</a></li>
<li><a class="reference internal" href="#defusedexpat" id="id8">defusedexpat</a></li>
<li><a class="reference internal" href="#how-to-avoid-xml-vulnerabilities" id="id9">How to avoid XML vulnerabilities</a></li>
<li><a class="reference internal" href="#other-things-to-consider" id="id10">Other things to consider</a></li>
<li><a class="reference internal" href="#related-cves" id="id11">Related CVEs</a></li>
<li><a class="reference internal" href="#other-languages-frameworks" id="id12">Other languages / frameworks</a></li>
<li><a class="reference internal" href="#todo" id="id13">TODO</a></li>
<li><a class="reference internal" href="#license" id="id14">License</a></li>
<li><a class="reference internal" href="#acknowledgements" id="id15">Acknowledgements</a></li>
<li><a class="reference internal" href="#references" id="id16">References</a></li>
<li><a class="reference internal" href="#changelog" id="id17">Changelog</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="attack-vectors">
<h2><a class="toc-backref" href="#id5">Attack vectors</a><a class="headerlink" href="#attack-vectors" title="Permalink to this headline">¶</a></h2>
<div class="section" id="billion-laughs-exponential-entity-expansion">
<h3>billion laughs / exponential entity expansion<a class="headerlink" href="#billion-laughs-exponential-entity-expansion" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://en.wikipedia.org/wiki/Billion_laughs">Billion Laughs</a> attack – also known as exponential entity expansion –
uses multiple levels of nested entities. The original example uses 9 levels
of 10 expansions in each level to expand the string <code class="docutils literal notranslate"><span class="pre">lol</span></code> to a string of
3 * 10 <sup>9</sup> bytes, hence the name “billion laughs”. The resulting string
occupies 3 GB (2.79 GiB) of memory; intermediate strings require additional
memory. Because most parsers don’t cache the intermediate step for every
expansion it is repeated over and over again. It increases the CPU load even
more.</p>
<p>An XML document of just a few hundred bytes can disrupt all services on a
machine within seconds.</p>
<p>Example XML:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!DOCTYPE xmlbomb [
&lt;!ENTITY a &quot;1234567890&quot; &gt;
&lt;!ENTITY b &quot;&amp;a;&amp;a;&amp;a;&amp;a;&amp;a;&amp;a;&amp;a;&amp;a;&quot;&gt;
&lt;!ENTITY c &quot;&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;&quot;&gt;
&lt;!ENTITY d &quot;&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;&quot;&gt;
]&gt;
&lt;bomb&gt;&amp;d;&lt;/bomb&gt;
</pre></div>
</div>
</div>
<div class="section" id="quadratic-blowup-entity-expansion">
<h3>quadratic blowup entity expansion<a class="headerlink" href="#quadratic-blowup-entity-expansion" title="Permalink to this headline">¶</a></h3>
<p>A quadratic blowup attack is similar to a <a class="reference external" href="http://en.wikipedia.org/wiki/Billion_laughs">Billion Laughs</a> attack; it abuses
entity expansion, too. Instead of nested entities it repeats one large entity
with a couple of thousand chars over and over again. The attack isn’t as
efficient as the exponential case but it avoids triggering countermeasures of
parsers against heavily nested entities. Some parsers limit the depth and
breadth of a single entity but not the total amount of expanded text
throughout an entire XML document.</p>
<p>A medium-sized XML document with a couple of hundred kilobytes can require a
couple of hundred MB to several GB of memory. When the attack is combined
with some level of nested expansion an attacker is able to achieve a higher
ratio of success.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!DOCTYPE bomb [
&lt;!ENTITY a &quot;xxxxxxx... a couple of ten thousand chars&quot;&gt;
]&gt;
&lt;bomb&gt;&amp;a;&amp;a;&amp;a;... repeat&lt;/bomb&gt;
</pre></div>
</div>
</div>
<div class="section" id="external-entity-expansion-remote">
<h3>external entity expansion (remote)<a class="headerlink" href="#external-entity-expansion-remote" title="Permalink to this headline">¶</a></h3>
<p>Entity declarations can contain more than just text for replacement. They can
also point to external resources by public identifiers or system identifiers.
System identifiers are standard URIs. When the URI is a URL (e.g. a
<code class="docutils literal notranslate"><span class="pre">http://</span></code> locator) some parsers download the resource from the remote
location and embed them into the XML document verbatim.</p>
<p>Simple example of a parsed external entity:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!DOCTYPE external [
&lt;!ENTITY ee SYSTEM &quot;http://www.python.org/some.xml&quot;&gt;
]&gt;
&lt;root&gt;&amp;ee;&lt;/root&gt;
</pre></div>
</div>
<p>The case of parsed external entities works only for valid XML content. The
XML standard also supports unparsed external entities with a
<code class="docutils literal notranslate"><span class="pre">NData</span> <span class="pre">declaration</span></code>.</p>
<p>External entity expansion opens the door to plenty of exploits. An attacker
can abuse a vulnerable XML library and application to rebound and forward
network requests with the IP address of the server. It highly depends
on the parser and the application what kind of exploit is possible. For
example:</p>
<ul class="simple">
<li>An attacker can circumvent firewalls and gain access to restricted
resources as all the requests are made from an internal and trustworthy
IP address, not from the outside.</li>
<li>An attacker can abuse a service to attack, spy on or DoS your servers but
also third party services. The attack is disguised with the IP address of
the server and the attacker is able to utilize the high bandwidth of a big
machine.</li>
<li>An attacker can exhaust additional resources on the machine, e.g. with
requests to a service that doesn’t respond or responds with very large
files.</li>
<li>An attacker may gain knowledge, when, how often and from which IP address
a XML document is accessed.</li>
<li>An attacker could send mail from inside your network if the URL handler
supports <code class="docutils literal notranslate"><span class="pre">smtp://</span></code> URIs.</li>
</ul>
</div>
<div class="section" id="external-entity-expansion-local-file">
<h3>external entity expansion (local file)<a class="headerlink" href="#external-entity-expansion-local-file" title="Permalink to this headline">¶</a></h3>
<p>External entities with references to local files are a sub-case of external
entity expansion. It’s listed as an extra attack because it deserves extra
attention. Some XML libraries such as lxml disable network access by default
but still allow entity expansion with local file access by default. Local
files are either referenced with a <code class="docutils literal notranslate"><span class="pre">file://</span></code> URL or by a file path (either
relative or absolute).</p>
<p>An attacker may be able to access and download all files that can be read by
the application process. This may include critical configuration files, too.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!DOCTYPE external [
&lt;!ENTITY ee SYSTEM &quot;file:///PATH/TO/simple.xml&quot;&gt;
]&gt;
&lt;root&gt;&amp;ee;&lt;/root&gt;
</pre></div>
</div>
</div>
<div class="section" id="dtd-retrieval">
<h3>DTD retrieval<a class="headerlink" href="#dtd-retrieval" title="Permalink to this headline">¶</a></h3>
<p>This case is similar to external entity expansion, too. Some XML libraries
like Python’s xml.dom.pulldom retrieve document type definitions from remote
or local locations. Several attack scenarios from the external entity case
apply to this issue as well.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
  &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;
&lt;html&gt;
    &lt;head/&gt;
    &lt;body&gt;text&lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="python-xml-libraries">
<h2><a class="toc-backref" href="#id6">Python XML Libraries</a><a class="headerlink" href="#python-xml-libraries" title="Permalink to this headline">¶</a></h2>
<table border="1" class="colwidths-given docutils" id="id2">
<caption><span class="caption-text">vulnerabilities and features</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="31%" />
<col width="9%" />
<col width="10%" />
<col width="10%" />
<col width="9%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">kind</th>
<th class="head">sax</th>
<th class="head">etree</th>
<th class="head">minidom</th>
<th class="head">pulldom</th>
<th class="head">xmlrpc</th>
<th class="head">lxml</th>
<th class="head">genshi</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>billion laughs</td>
<td><strong>True</strong></td>
<td><strong>True</strong></td>
<td><strong>True</strong></td>
<td><strong>True</strong></td>
<td><strong>True</strong></td>
<td>False (1)</td>
<td>False (5)</td>
</tr>
<tr class="row-odd"><td>quadratic blowup</td>
<td><strong>True</strong></td>
<td><strong>True</strong></td>
<td><strong>True</strong></td>
<td><strong>True</strong></td>
<td><strong>True</strong></td>
<td><strong>True</strong></td>
<td>False (5)</td>
</tr>
<tr class="row-even"><td>external entity expansion (remote)</td>
<td><strong>True</strong></td>
<td>False (3)</td>
<td>False (4)</td>
<td><strong>True</strong></td>
<td>false</td>
<td>False (1)</td>
<td>False (5)</td>
</tr>
<tr class="row-odd"><td>external entity expansion (local file)</td>
<td><strong>True</strong></td>
<td>False (3)</td>
<td>False (4)</td>
<td><strong>True</strong></td>
<td>false</td>
<td><strong>True</strong></td>
<td>False (5)</td>
</tr>
<tr class="row-even"><td>DTD retrieval</td>
<td><strong>True</strong></td>
<td>False</td>
<td>False</td>
<td><strong>True</strong></td>
<td>false</td>
<td>False (1)</td>
<td>False</td>
</tr>
<tr class="row-odd"><td>gzip bomb</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td><strong>True</strong></td>
<td><strong>partly</strong> (2)</td>
<td>False</td>
</tr>
<tr class="row-even"><td>xpath support (7)</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td><strong>True</strong></td>
<td>False</td>
</tr>
<tr class="row-odd"><td>xsl(t) support (7)</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td><strong>True</strong></td>
<td>False</td>
</tr>
<tr class="row-even"><td>xinclude support (7)</td>
<td>False</td>
<td><strong>True</strong> (6)</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td><strong>True</strong> (6)</td>
<td><strong>True</strong></td>
</tr>
<tr class="row-odd"><td>C library</td>
<td>expat</td>
<td>expat</td>
<td>expat</td>
<td>expat</td>
<td>expat</td>
<td>libxml2</td>
<td>expat</td>
</tr>
</tbody>
</table>
<ol class="arabic simple">
<li>Lxml is protected against billion laughs attacks and doesn’t do network
lookups by default.</li>
<li>libxml2 and lxml are not directly vulnerable to gzip decompression bombs
but they don’t protect you against them either.</li>
<li>xml.etree doesn’t expand entities and raises a ParserError when an entity
occurs.</li>
<li>minidom doesn’t expand entities and simply returns the unexpanded entity
verbatim.</li>
<li>genshi.input of genshi 0.6 doesn’t support entity expansion and raises a
ParserError when an entity occurs.</li>
<li>Library has (limited) XInclude support but requires an additional step to
process inclusion.</li>
<li>These are features but they may introduce exploitable holes, see
<a class="reference internal" href="#other-things-to-consider">Other things to consider</a></li>
</ol>
<div class="section" id="settings-in-standard-library">
<h3>Settings in standard library<a class="headerlink" href="#settings-in-standard-library" title="Permalink to this headline">¶</a></h3>
<div class="section" id="xml-sax-handler-features">
<h4>xml.sax.handler Features<a class="headerlink" href="#xml-sax-handler-features" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>feature_external_ges (<a class="reference external" href="http://xml.org/sax/features/external-general-entities">http://xml.org/sax/features/external-general-entities</a>)</dt>
<dd>disables external entity expansion</dd>
<dt>feature_external_pes (<a class="reference external" href="http://xml.org/sax/features/external-parameter-entities">http://xml.org/sax/features/external-parameter-entities</a>)</dt>
<dd>the option is ignored and doesn’t modify any functionality</dd>
</dl>
</div>
<div class="section" id="dom-xml-dom-xmlbuilder-options">
<h4>DOM xml.dom.xmlbuilder.Options<a class="headerlink" href="#dom-xml-dom-xmlbuilder-options" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>external_parameter_entities</dt>
<dd>ignored</dd>
<dt>external_general_entities</dt>
<dd>ignored</dd>
<dt>external_dtd_subset</dt>
<dd>ignored</dd>
<dt>entities</dt>
<dd>unsure</dd>
</dl>
</div>
</div>
</div>
<div class="section" id="defusedxml">
<h2><a class="toc-backref" href="#id7">defusedxml</a><a class="headerlink" href="#defusedxml" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://bitbucket.org/tiran/defusedxml">defusedxml package</a> (<a class="reference external" href="https://pypi.python.org/pypi/defusedxml">defusedxml on PyPI</a>)
contains several Python-only workarounds and fixes
for denial of service and other vulnerabilities in Python’s XML libraries.
In order to benefit from the protection you just have to import and use the
listed functions / classes from the right defusedxml module instead of the
original module. Merely <a class="reference internal" href="#defusedxml-xmlrpc">defusedxml.xmlrpc</a> is implemented as monkey patch.</p>
<p>Instead of:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">import</span> <span class="n">parse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">et</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">xmlfile</span><span class="p">)</span>
</pre></div>
</div>
<p>alter code to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">defusedxml.ElementTree</span> <span class="k">import</span> <span class="n">parse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">et</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">xmlfile</span><span class="p">)</span>
</pre></div>
</div>
<p>Additionally the package has an <strong>untested</strong> function to monkey patch
all stdlib modules with <code class="docutils literal notranslate"><span class="pre">defusedxml.defuse_stdlib()</span></code>.</p>
<p>All functions and parser classes accept three additional keyword arguments.
They return either the same objects as the original functions or compatible
subclasses.</p>
<dl class="docutils">
<dt>forbid_dtd (default: False)</dt>
<dd>disallow XML with a <code class="docutils literal notranslate"><span class="pre">&lt;!DOCTYPE&gt;</span></code> processing instruction and raise a
<em>DTDForbidden</em> exception when a DTD processing instruction is found.</dd>
<dt>forbid_entities (default: True)</dt>
<dd>disallow XML with <code class="docutils literal notranslate"><span class="pre">&lt;!ENTITY&gt;</span></code> declarations inside the DTD and raise an
<em>EntitiesForbidden</em> exception when an entity is declared.</dd>
<dt>forbid_external (default: True)</dt>
<dd>disallow any access to remote or local resources in external entities
or DTD and raising an <em>ExternalReferenceForbidden</em> exception when a DTD
or entity references an external resource.</dd>
</dl>
<div class="section" id="defusedxml-package">
<h3>defusedxml (package)<a class="headerlink" href="#defusedxml-package" title="Permalink to this headline">¶</a></h3>
<p>DefusedXmlException, DTDForbidden, EntitiesForbidden,
ExternalReferenceForbidden, NotSupportedError</p>
<p>defuse_stdlib() (<em>experimental</em>)</p>
</div>
<div class="section" id="defusedxml-celementtree">
<h3>defusedxml.cElementTree<a class="headerlink" href="#defusedxml-celementtree" title="Permalink to this headline">¶</a></h3>
<p>parse(), iterparse(), fromstring(), XMLParser</p>
</div>
<div class="section" id="defusedxml-elementtree">
<h3>defusedxml.ElementTree<a class="headerlink" href="#defusedxml-elementtree" title="Permalink to this headline">¶</a></h3>
<p>parse(), iterparse(), fromstring(), XMLParser</p>
</div>
<div class="section" id="defusedxml-expatreader">
<h3>defusedxml.expatreader<a class="headerlink" href="#defusedxml-expatreader" title="Permalink to this headline">¶</a></h3>
<p>create_parser(), DefusedExpatParser</p>
</div>
<div class="section" id="defusedxml-sax">
<h3>defusedxml.sax<a class="headerlink" href="#defusedxml-sax" title="Permalink to this headline">¶</a></h3>
<p>parse(), parseString(), create_parser()</p>
</div>
<div class="section" id="defusedxml-expatbuilder">
<h3>defusedxml.expatbuilder<a class="headerlink" href="#defusedxml-expatbuilder" title="Permalink to this headline">¶</a></h3>
<p>parse(), parseString(), DefusedExpatBuilder, DefusedExpatBuilderNS</p>
</div>
<div class="section" id="defusedxml-minidom">
<h3>defusedxml.minidom<a class="headerlink" href="#defusedxml-minidom" title="Permalink to this headline">¶</a></h3>
<p>parse(), parseString()</p>
</div>
<div class="section" id="defusedxml-pulldom">
<h3>defusedxml.pulldom<a class="headerlink" href="#defusedxml-pulldom" title="Permalink to this headline">¶</a></h3>
<p>parse(), parseString()</p>
</div>
<div class="section" id="defusedxml-xmlrpc">
<h3>defusedxml.xmlrpc<a class="headerlink" href="#defusedxml-xmlrpc" title="Permalink to this headline">¶</a></h3>
<p>The fix is implemented as monkey patch for the stdlib’s xmlrpc package (3.x)
or xmlrpclib module (2.x). The function <cite>monkey_patch()</cite> enables the fixes,
<cite>unmonkey_patch()</cite> removes the patch and puts the code in its former state.</p>
<p>The monkey patch protects against XML related attacks as well as
decompression bombs and excessively large requests or responses. The default
setting is 30 MB for requests, responses and gzip decompression. You can
modify the default by changing the module variable <cite>MAX_DATA</cite>. A value of
<cite>-1</cite> disables the limit.</p>
</div>
<div class="section" id="defusedxml-lxml">
<h3>defusedxml.lxml<a class="headerlink" href="#defusedxml-lxml" title="Permalink to this headline">¶</a></h3>
<p>The module acts as an <em>example</em> how you could protect code that uses
lxml.etree. It implements a custom Element class that filters out
Entity instances, a custom parser factory and a thread local storage for
parser instances. It also has a check_docinfo() function which inspects
a tree for internal or external DTDs and entity declarations. In order to
check for entities lxml &gt; 3.0 is required.</p>
<p>parse(), fromstring()
RestrictedElement, GlobalParserTLS, getDefaultParser(), check_docinfo()</p>
</div>
</div>
<div class="section" id="defusedexpat">
<h2><a class="toc-backref" href="#id8">defusedexpat</a><a class="headerlink" href="#defusedexpat" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://bitbucket.org/tiran/defusedexpat">defusedexpat package</a> (<a class="reference external" href="https://pypi.python.org/pypi/defusedexpat">defusedexpat on PyPI</a>)
comes with binary extensions and a
<a class="reference external" href="https://bitbucket.org/tiran/expat">modified expat</a> libary instead of the standard <a class="reference external" href="http://expat.sourceforge.net/">expat parser</a>. It’s
basically a stand-alone version of the patches for Python’s standard
library C extensions.</p>
<div class="section" id="modifications-in-expat">
<h3>Modifications in expat<a class="headerlink" href="#modifications-in-expat" title="Permalink to this headline">¶</a></h3>
<p>new definitions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">XML_BOMB_PROTECTION</span>
<span class="n">XML_DEFAULT_MAX_ENTITY_INDIRECTIONS</span>
<span class="n">XML_DEFAULT_MAX_ENTITY_EXPANSIONS</span>
<span class="n">XML_DEFAULT_RESET_DTD</span>
</pre></div>
</div>
<p>new XML_FeatureEnum members:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">XML_FEATURE_MAX_ENTITY_INDIRECTIONS</span>
<span class="n">XML_FEATURE_MAX_ENTITY_EXPANSIONS</span>
<span class="n">XML_FEATURE_IGNORE_DTD</span>
</pre></div>
</div>
<p>new XML_Error members:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">XML_ERROR_ENTITY_INDIRECTIONS</span>
<span class="n">XML_ERROR_ENTITY_EXPANSION</span>
</pre></div>
</div>
<p>new API functions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">XML_GetFeature</span><span class="p">(</span><span class="n">XML_Parser</span> <span class="n">parser</span><span class="p">,</span>
                   <span class="n">enum</span> <span class="n">XML_FeatureEnum</span> <span class="n">feature</span><span class="p">,</span>
                   <span class="n">long</span> <span class="o">*</span><span class="n">value</span><span class="p">);</span>
<span class="nb">int</span> <span class="n">XML_SetFeature</span><span class="p">(</span><span class="n">XML_Parser</span> <span class="n">parser</span><span class="p">,</span>
                   <span class="n">enum</span> <span class="n">XML_FeatureEnum</span> <span class="n">feature</span><span class="p">,</span>
                   <span class="n">long</span> <span class="n">value</span><span class="p">);</span>
<span class="nb">int</span> <span class="n">XML_GetFeatureDefault</span><span class="p">(</span><span class="n">enum</span> <span class="n">XML_FeatureEnum</span> <span class="n">feature</span><span class="p">,</span>
                          <span class="n">long</span> <span class="o">*</span><span class="n">value</span><span class="p">);</span>
<span class="nb">int</span> <span class="n">XML_SetFeatureDefault</span><span class="p">(</span><span class="n">enum</span> <span class="n">XML_FeatureEnum</span> <span class="n">feature</span><span class="p">,</span>
                          <span class="n">long</span> <span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<dl class="docutils">
<dt>XML_FEATURE_MAX_ENTITY_INDIRECTIONS</dt>
<dd><p class="first">Limit the amount of indirections that are allowed to occur during the
expansion of a nested entity. A counter starts when an entity reference
is encountered. It resets after the entity is fully expanded. The limit
protects the parser against exponential entity expansion attacks (aka
billion laughs attack). When the limit is exceeded the parser stops and
fails with <cite>XML_ERROR_ENTITY_INDIRECTIONS</cite>.
A value of 0 disables the protection.</p>
<dl class="last docutils">
<dt>Supported range</dt>
<dd>0 .. UINT_MAX</dd>
<dt>Default</dt>
<dd>40</dd>
</dl>
</dd>
<dt>XML_FEATURE_MAX_ENTITY_EXPANSIONS</dt>
<dd><p class="first">Limit the total length of all entity expansions throughout the entire
document. The lengths of all entities are accumulated in a parser variable.
The setting protects against quadratic blowup attacks (lots of expansions
of a large entity declaration). When the sum of all entities exceeds
the limit, the parser stops and fails with <cite>XML_ERROR_ENTITY_EXPANSION</cite>.
A value of 0 disables the protection.</p>
<dl class="last docutils">
<dt>Supported range</dt>
<dd>0 .. UINT_MAX</dd>
<dt>Default</dt>
<dd>8 MiB</dd>
</dl>
</dd>
<dt>XML_FEATURE_RESET_DTD</dt>
<dd><p class="first">Reset all DTD information after the &lt;!DOCTYPE&gt; block has been parsed. When
the flag is set (default: false) all DTD information after the
endDoctypeDeclHandler has been called. The flag can be set inside the
endDoctypeDeclHandler. Without DTD information any entity reference in
the document body leads to <cite>XML_ERROR_UNDEFINED_ENTITY</cite>.</p>
<dl class="last docutils">
<dt>Supported range</dt>
<dd>0, 1</dd>
<dt>Default</dt>
<dd>0</dd>
</dl>
</dd>
</dl>
</div>
</div>
<div class="section" id="how-to-avoid-xml-vulnerabilities">
<h2><a class="toc-backref" href="#id9">How to avoid XML vulnerabilities</a><a class="headerlink" href="#how-to-avoid-xml-vulnerabilities" title="Permalink to this headline">¶</a></h2>
<div class="section" id="best-practices">
<h3>Best practices<a class="headerlink" href="#best-practices" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Don’t allow DTDs</li>
<li>Don’t expand entities</li>
<li>Don’t resolve externals</li>
<li>Limit parse depth</li>
<li>Limit total input size</li>
<li>Limit parse time</li>
<li>Favor a SAX or iterparse-like parser for potential large data</li>
<li>Validate and properly quote arguments to XSL transformations and
XPath queries</li>
<li>Don’t use XPath expression from untrusted sources</li>
<li>Don’t apply XSL transformations that come untrusted sources</li>
</ul>
<p>(based on Brad Hill’s <a class="reference external" href="https://www.isecpartners.com/media/12976/iSEC-HILL-Attacking-XML-Security-bh07.pdf">Attacking XML Security</a>)</p>
</div>
</div>
<div class="section" id="other-things-to-consider">
<h2><a class="toc-backref" href="#id10">Other things to consider</a><a class="headerlink" href="#other-things-to-consider" title="Permalink to this headline">¶</a></h2>
<p>XML, XML parsers and processing libraries have more features and possible
issue that could lead to DoS vulnerabilities or security exploits in
applications. I have compiled an incomplete list of theoretical issues that
need further research and more attention. The list is deliberately pessimistic
and a bit paranoid, too. It contains things that might go wrong under daffy
circumstances.</p>
<div class="section" id="attribute-blowup-hash-collision-attack">
<h3>attribute blowup / hash collision attack<a class="headerlink" href="#attribute-blowup-hash-collision-attack" title="Permalink to this headline">¶</a></h3>
<p>XML parsers may use an algorithm with quadratic runtime O(n <sup>2</sup>) to
handle attributes and namespaces. If it uses hash tables (dictionaries) to
store attributes and namespaces the implementation may be vulnerable to
hash collision attacks, thus reducing the performance to O(n <sup>2</sup>) again.
In either case an attacker is able to forge a denial of service attack with
an XML document that contains thousands upon thousands of attributes in
a single node.</p>
<p>I haven’t researched yet if expat, pyexpat or libxml2 are vulnerable.</p>
</div>
<div class="section" id="decompression-bomb">
<h3>decompression bomb<a class="headerlink" href="#decompression-bomb" title="Permalink to this headline">¶</a></h3>
<p>The issue of decompression bombs (aka <a class="reference external" href="http://en.wikipedia.org/wiki/Zip_bomb">ZIP bomb</a>) apply to all XML libraries
that can parse compressed XML stream like gzipped HTTP streams or LZMA-ed
files. For an attacker it can reduce the amount of transmitted data by three
magnitudes or more. Gzip is able to compress 1 GiB zeros to roughly 1 MB,
lzma is even better:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ dd if=/dev/zero bs=1M count=1024 | gzip &gt; zeros.gz
$ dd if=/dev/zero bs=1M count=1024 | lzma -z &gt; zeros.xy
$ ls -sh zeros.*
1020K zeros.gz
 148K zeros.xy
</pre></div>
</div>
<p>None of Python’s standard XML libraries decompress streams except for
<code class="docutils literal notranslate"><span class="pre">xmlrpclib</span></code>. The module is vulnerable &lt;<a class="reference external" href="http://bugs.python.org/issue16043">http://bugs.python.org/issue16043</a>&gt;
to decompression bombs.</p>
<p>lxml can load and process compressed data through libxml2 transparently.
libxml2 can handle even very large blobs of compressed data efficiently
without using too much memory. But it doesn’t protect applications from
decompression bombs. A carefully written SAX or iterparse-like approach can
be safe.</p>
</div>
<div class="section" id="processing-instruction">
<h3>Processing Instruction<a class="headerlink" href="#processing-instruction" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Processing_Instruction">PI</a>’s like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;style.xsl&quot;?&gt;
</pre></div>
</div>
<p>may impose more threats for XML processing. It depends if and how a
processor handles processing instructions. The issue of URL retrieval with
network or local file access apply to processing instructions, too.</p>
</div>
<div class="section" id="other-dtd-features">
<h3>Other DTD features<a class="headerlink" href="#other-dtd-features" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/Document_Type_Definition">DTD</a> has more features like <code class="docutils literal notranslate"><span class="pre">&lt;!NOTATION&gt;</span></code>. I haven’t researched how
these features may be a security threat.</p>
</div>
<div class="section" id="xpath">
<h3>XPath<a class="headerlink" href="#xpath" title="Permalink to this headline">¶</a></h3>
<p>XPath statements may introduce DoS vulnerabilities. Code should never execute
queries from untrusted sources. An attacker may also be able to create a XML
document that makes certain XPath queries costly or resource hungry.</p>
</div>
<div class="section" id="xpath-injection-attacks">
<h3>XPath injection attacks<a class="headerlink" href="#xpath-injection-attacks" title="Permalink to this headline">¶</a></h3>
<p>XPath injeciton attacks pretty much work like SQL injection attacks.
Arguments to XPath queries must be quoted and validated properly, especially
when they are taken from the user. The page <a class="reference external" href="http://www.ibm.com/developerworks/xml/library/x-xpathinjection/index.html">Avoid the dangers of XPath injection</a>
list some ramifications of XPath injections.</p>
<p>Python’s standard library doesn’t have XPath support. Lxml supports
parameterized XPath queries which does proper quoting. You just have to use
its xpath() method correctly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># DON&#39;T</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&quot;/tag[@id=&#39;</span><span class="si">%s</span><span class="s2">&#39;]&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>

<span class="c1"># instead do</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&quot;/tag[@id=$tagid]&quot;</span><span class="p">,</span> <span class="n">tagid</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="xinclude">
<h3>XInclude<a class="headerlink" href="#xinclude" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.w3.org/TR/xinclude/#include_element">XML Inclusion</a> is another way to load and include external files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">root</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">xi</span><span class="o">=</span><span class="s2">&quot;http://www.w3.org/2001/XInclude&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">xi</span><span class="p">:</span><span class="n">include</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;filename.txt&quot;</span> <span class="n">parse</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This feature should be disabled when XML files from an untrusted source are
processed. Some Python XML libraries and libxml2 support XInclude but don’t
have an option to sandbox inclusion and limit it to allowed directories.</p>
</div>
<div class="section" id="xmlschema-location">
<h3>XMLSchema location<a class="headerlink" href="#xmlschema-location" title="Permalink to this headline">¶</a></h3>
<p>A validating XML parser may download schema files from the information in a
<code class="docutils literal notranslate"><span class="pre">xsi:schemaLocation</span></code> attribute.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">ead</span> <span class="n">xmlns</span><span class="o">=</span><span class="s2">&quot;urn:isbn:1-931666-22-9&quot;</span>
     <span class="n">xmlns</span><span class="p">:</span><span class="n">xsi</span><span class="o">=</span><span class="s2">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
     <span class="n">xsi</span><span class="p">:</span><span class="n">schemaLocation</span><span class="o">=</span><span class="s2">&quot;urn:isbn:1-931666-22-9 http://www.loc.gov/ead/ead.xsd&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">ead</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="xsl-transformation">
<h3>XSL Transformation<a class="headerlink" href="#xsl-transformation" title="Permalink to this headline">¶</a></h3>
<p>You should keep in mind that XSLT is a Turing complete language. Never
process XSLT code from unknown or untrusted source! XSLT processors may
allow you to interact with external resources in ways you can’t even imagine.
Some processors even support extensions that allow read/write access to file
system, access to JRE objects or scripting with Jython.</p>
<p>Example from <a class="reference external" href="https://www.isecpartners.com/media/12976/iSEC-HILL-Attacking-XML-Security-bh07.pdf">Attacking XML Security</a> for Xalan-J:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">xsl</span><span class="p">:</span><span class="n">stylesheet</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span>
 <span class="n">xmlns</span><span class="p">:</span><span class="n">xsl</span><span class="o">=</span><span class="s2">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span>
 <span class="n">xmlns</span><span class="p">:</span><span class="n">rt</span><span class="o">=</span><span class="s2">&quot;http://xml.apache.org/xalan/java/java.lang.Runtime&quot;</span>
 <span class="n">xmlns</span><span class="p">:</span><span class="n">ob</span><span class="o">=</span><span class="s2">&quot;http://xml.apache.org/xalan/java/java.lang.Object&quot;</span>
 <span class="n">exclude</span><span class="o">-</span><span class="n">result</span><span class="o">-</span><span class="n">prefixes</span><span class="o">=</span> <span class="s2">&quot;rt ob&quot;</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">xsl</span><span class="p">:</span><span class="n">template</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">xsl</span><span class="p">:</span><span class="n">variable</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;runtimeObject&quot;</span> <span class="n">select</span><span class="o">=</span><span class="s2">&quot;rt:getRuntime()&quot;</span><span class="o">/&gt;</span>
   <span class="o">&lt;</span><span class="n">xsl</span><span class="p">:</span><span class="n">variable</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;command&quot;</span>
     <span class="n">select</span><span class="o">=</span><span class="s2">&quot;rt:exec($runtimeObject, &amp;apos;c:\Windows\system32\cmd.exe&amp;apos;)&quot;</span><span class="o">/&gt;</span>
   <span class="o">&lt;</span><span class="n">xsl</span><span class="p">:</span><span class="n">variable</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;commandAsString&quot;</span> <span class="n">select</span><span class="o">=</span><span class="s2">&quot;ob:toString($command)&quot;</span><span class="o">/&gt;</span>
   <span class="o">&lt;</span><span class="n">xsl</span><span class="p">:</span><span class="n">value</span><span class="o">-</span><span class="n">of</span> <span class="n">select</span><span class="o">=</span><span class="s2">&quot;$commandAsString&quot;</span><span class="o">/&gt;</span>
 <span class="o">&lt;/</span><span class="n">xsl</span><span class="p">:</span><span class="n">template</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">xsl</span><span class="p">:</span><span class="n">stylesheet</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="related-cves">
<h2><a class="toc-backref" href="#id11">Related CVEs</a><a class="headerlink" href="#related-cves" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>CVE-2013-1664</dt>
<dd>Unrestricted entity expansion induces DoS vulnerabilities in Python XML
libraries (XML bomb)</dd>
<dt>CVE-2013-1665</dt>
<dd>External entity expansion in Python XML libraries inflicts potential
security flaws and DoS vulnerabilities</dd>
</dl>
</div>
<div class="section" id="other-languages-frameworks">
<h2><a class="toc-backref" href="#id12">Other languages / frameworks</a><a class="headerlink" href="#other-languages-frameworks" title="Permalink to this headline">¶</a></h2>
<p>Several other programming languages and frameworks are vulnerable as well. A
couple of them are affected by the fact that libxml2 up to 2.9.0 has no
protection against quadratic blowup attacks. Most of them have potential
dangerous default settings for entity expansion and external entities, too.</p>
<div class="section" id="perl">
<h3>Perl<a class="headerlink" href="#perl" title="Permalink to this headline">¶</a></h3>
<p>Perl’s XML::Simple is vulnerable to quadratic entity expansion and external
entity expansion (both local and remote).</p>
</div>
<div class="section" id="ruby">
<h3>Ruby<a class="headerlink" href="#ruby" title="Permalink to this headline">¶</a></h3>
<p>Ruby’s REXML document parser is vulnerable to entity expansion attacks
(both quadratic and exponential) but it doesn’t do external entity
expansion by default. In order to counteract entity expansion you have to
disable the feature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">REXML</span><span class="p">::</span><span class="n">Document</span><span class="o">.</span><span class="n">entity_expansion_limit</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>libxml-ruby and hpricot don’t expand entities in their default configuration.</p>
</div>
<div class="section" id="php">
<h3>PHP<a class="headerlink" href="#php" title="Permalink to this headline">¶</a></h3>
<p>PHP’s SimpleXML API is vulnerable to quadratic entity expansion and loads
entites from local and remote resources. The option <code class="docutils literal notranslate"><span class="pre">LIBXML_NONET</span></code> disables
network access but still allows local file access. <code class="docutils literal notranslate"><span class="pre">LIBXML_NOENT</span></code> seems to
have no effect on entity expansion in PHP 5.4.6.</p>
</div>
<div class="section" id="c-net-mono">
<h3>C# / .NET / Mono<a class="headerlink" href="#c-net-mono" title="Permalink to this headline">¶</a></h3>
<p>Information in <a class="reference external" href="http://msdn.microsoft.com/en-us/magazine/ee335713.aspx">XML DoS and Defenses (MSDN)</a> suggest that .NET is
vulnerable with its default settings. The article contains code snippets
how to create a secure XML reader:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">XmlReaderSettings</span> <span class="n">settings</span> <span class="o">=</span> <span class="n">new</span> <span class="n">XmlReaderSettings</span><span class="p">();</span>
<span class="n">settings</span><span class="o">.</span><span class="n">ProhibitDtd</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span>
<span class="n">settings</span><span class="o">.</span><span class="n">MaxCharactersFromEntities</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>
<span class="n">settings</span><span class="o">.</span><span class="n">XmlResolver</span> <span class="o">=</span> <span class="n">null</span><span class="p">;</span>
<span class="n">XmlReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">XmlReader</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">settings</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="java">
<h3>Java<a class="headerlink" href="#java" title="Permalink to this headline">¶</a></h3>
<p>Untested. The documentation of Xerces and its <a class="reference external" href="http://xerces.apache.org/xerces2-j/javadocs/xerces2/org/apache/xerces/util/SecurityManager.html">Xerces SecurityMananger</a>
sounds like Xerces is also vulnerable to billion laugh attacks with its
default settings. It also does entity resolving when an
<code class="docutils literal notranslate"><span class="pre">org.xml.sax.EntityResolver</span></code> is configured. I’m not yet sure about the
default setting here.</p>
<p>Java specialists suggest to have a custom builder factory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DocumentBuilderFactory</span> <span class="n">builderFactory</span> <span class="o">=</span> <span class="n">DocumentBuilderFactory</span><span class="o">.</span><span class="n">newInstance</span><span class="p">();</span>
<span class="n">builderFactory</span><span class="o">.</span><span class="n">setXIncludeAware</span><span class="p">(</span><span class="kc">False</span><span class="p">);</span>
<span class="n">builderFactory</span><span class="o">.</span><span class="n">setExpandEntityReferences</span><span class="p">(</span><span class="kc">False</span><span class="p">);</span>
<span class="n">builderFactory</span><span class="o">.</span><span class="n">setFeature</span><span class="p">(</span><span class="n">XMLConstants</span><span class="o">.</span><span class="n">FEATURE_SECURE_PROCESSING</span><span class="p">,</span> <span class="kc">True</span><span class="p">);</span>
<span class="c1"># either</span>
<span class="n">builderFactory</span><span class="o">.</span><span class="n">setFeature</span><span class="p">(</span><span class="s2">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">);</span>
<span class="c1"># or if you need DTDs</span>
<span class="n">builderFactory</span><span class="o">.</span><span class="n">setFeature</span><span class="p">(</span><span class="s2">&quot;http://xml.org/sax/features/external-general-entities&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">);</span>
<span class="n">builderFactory</span><span class="o">.</span><span class="n">setFeature</span><span class="p">(</span><span class="s2">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">);</span>
<span class="n">builderFactory</span><span class="o">.</span><span class="n">setFeature</span><span class="p">(</span><span class="s2">&quot;http://apache.org/xml/features/nonvalidating/load-external-dtd&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">);</span>
<span class="n">builderFactory</span><span class="o">.</span><span class="n">setFeature</span><span class="p">(</span><span class="s2">&quot;http://apache.org/xml/features/nonvalidating/load-dtd-grammar&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="todo">
<h2><a class="toc-backref" href="#id13">TODO</a><a class="headerlink" href="#todo" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>DOM: Use xml.dom.xmlbuilder options for entity handling</li>
<li>SAX: take feature_external_ges and feature_external_pes (?) into account</li>
<li>test experimental monkey patching of stdlib modules</li>
<li>improve documentation</li>
</ul>
</div>
<div class="section" id="license">
<h2><a class="toc-backref" href="#id14">License</a><a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h2>
<p>Copyright (c) 2013-2017 by Christian Heimes &lt;<a class="reference external" href="mailto:christian&#37;&#52;&#48;python&#46;org">christian<span>&#64;</span>python<span>&#46;</span>org</a>&gt;</p>
<p>Licensed to PSF under a Contributor Agreement.</p>
<p>See <a class="reference external" href="http://www.python.org/psf/license">http://www.python.org/psf/license</a> for licensing details.</p>
</div>
<div class="section" id="acknowledgements">
<h2><a class="toc-backref" href="#id15">Acknowledgements</a><a class="headerlink" href="#acknowledgements" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>Brett Cannon (Python Core developer)</dt>
<dd>review and code cleanup</dd>
<dt>Antoine Pitrou (Python Core developer)</dt>
<dd>code review</dd>
<dt>Aaron Patterson, Ben Murphy and Michael Koziarski (Ruby community)</dt>
<dd>Many thanks to Aaron, Ben and Michael from the Ruby community for their
report and assistance.</dd>
<dt>Thierry Carrez (OpenStack)</dt>
<dd>Many thanks to Thierry for his report to the Python Security Response
Team on behalf of the OpenStack security team.</dd>
<dt>Carl Meyer (Django)</dt>
<dd>Many thanks to Carl for his report to PSRT on behalf of the Django security
team.</dd>
<dt>Daniel Veillard (libxml2)</dt>
<dd>Many thanks to Daniel for his insight and assistance with libxml2.</dd>
<dt>semantics GmbH (<a class="reference external" href="http://www.semantics.de/">http://www.semantics.de/</a>)</dt>
<dd>Many thanks to my employer semantics for letting me work on the issue
during working hours as part of semantics’s open source initiative.</dd>
</dl>
</div>
<div class="section" id="references">
<h2><a class="toc-backref" href="#id16">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://msdn.microsoft.com/en-us/magazine/ee335713.aspx">XML DoS and Defenses (MSDN)</a></li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Billion_laughs">Billion Laughs</a> on Wikipedia</li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Zip_bomb">ZIP bomb</a> on Wikipedia</li>
<li><a class="reference external" href="http://www.ibm.com/developerworks/xml/library/x-tipcfsx/index.html">Configure SAX parsers for secure processing</a></li>
<li><a class="reference external" href="https://www.owasp.org/index.php/Testing_for_XML_Injection_(OWASP-DV-008)">Testing for XML Injection</a></li>
</ul>
</div>
<div class="section" id="changelog">
<h2><a class="toc-backref" href="#id17">Changelog</a><a class="headerlink" href="#changelog" title="Permalink to this headline">¶</a></h2>
<div class="section" id="defusedxml-0-5-0">
<h3>defusedxml 0.5.0<a class="headerlink" href="#defusedxml-0-5-0" title="Permalink to this headline">¶</a></h3>
<p><em>Release date: 07-Feb-2017</em></p>
<ul class="simple">
<li>No changes</li>
</ul>
</div>
<div class="section" id="defusedxml-0-5-0-rc1">
<h3>defusedxml 0.5.0.rc1<a class="headerlink" href="#defusedxml-0-5-0-rc1" title="Permalink to this headline">¶</a></h3>
<p><em>Release date: 28-Jan-2017</em></p>
<ul class="simple">
<li>Add compatibility with Python 3.6</li>
<li>Drop support for Python 2.6, 3.1, 3.2, 3.3</li>
<li>Fix lxml tests (XMLSyntaxError: Detected an entity reference loop)</li>
</ul>
</div>
<div class="section" id="defusedxml-0-4-1">
<h3>defusedxml 0.4.1<a class="headerlink" href="#defusedxml-0-4-1" title="Permalink to this headline">¶</a></h3>
<p><em>Release date: 28-Mar-2013</em></p>
<ul class="simple">
<li>Add more demo exploits, e.g. python_external.py and Xalan XSLT demos.</li>
<li>Improved documentation.</li>
</ul>
</div>
<div class="section" id="defusedxml-0-4">
<h3>defusedxml 0.4<a class="headerlink" href="#defusedxml-0-4" title="Permalink to this headline">¶</a></h3>
<p><em>Release date: 25-Feb-2013</em></p>
<ul class="simple">
<li>As per <a class="reference external" href="http://seclists.org/oss-sec/2013/q1/340">http://seclists.org/oss-sec/2013/q1/340</a> please REJECT
CVE-2013-0278, CVE-2013-0279 and CVE-2013-0280 and use CVE-2013-1664,
CVE-2013-1665 for OpenStack/etc.</li>
<li>Add missing parser_list argument to sax.make_parser(). The argument is
ignored, though. (thanks to Florian Apolloner)</li>
<li>Add demo exploit for external entity attack on Python’s SAX parser, XML-RPC
and WebDAV.</li>
</ul>
</div>
<div class="section" id="defusedxml-0-3">
<h3>defusedxml 0.3<a class="headerlink" href="#defusedxml-0-3" title="Permalink to this headline">¶</a></h3>
<p><em>Release date: 19-Feb-2013</em></p>
<ul class="simple">
<li>Improve documentation</li>
</ul>
</div>
<div class="section" id="defusedxml-0-2">
<h3>defusedxml 0.2<a class="headerlink" href="#defusedxml-0-2" title="Permalink to this headline">¶</a></h3>
<p><em>Release date: 15-Feb-2013</em></p>
<ul class="simple">
<li>Rename ExternalEntitiesForbidden to ExternalReferenceForbidden</li>
<li>Rename defusedxml.lxml.check_dtd() to check_docinfo()</li>
<li>Unify argument names in callbacks</li>
<li>Add arguments and formatted representation to exceptions</li>
<li>Add forbid_external argument to all functions and classs</li>
<li>More tests</li>
<li>LOTS of documentation</li>
<li>Add example code for other languages (Ruby, Perl, PHP) and parsers (Genshi)</li>
<li>Add protection against XML and gzip attacks to xmlrpclib</li>
</ul>
</div>
<div class="section" id="defusedxml-0-1">
<h3>defusedxml 0.1<a class="headerlink" href="#defusedxml-0-1" title="Permalink to this headline">¶</a></h3>
<p><em>Release date: 08-Feb-2013</em></p>
<ul class="simple">
<li>Initial and internal release for PSRT review</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">defusedxml – defusing XML bombs and other exploits</a><ul>
<li><a class="reference internal" href="#synopsis">Synopsis</a></li>
<li><a class="reference internal" href="#attack-vectors">Attack vectors</a><ul>
<li><a class="reference internal" href="#billion-laughs-exponential-entity-expansion">billion laughs / exponential entity expansion</a></li>
<li><a class="reference internal" href="#quadratic-blowup-entity-expansion">quadratic blowup entity expansion</a></li>
<li><a class="reference internal" href="#external-entity-expansion-remote">external entity expansion (remote)</a></li>
<li><a class="reference internal" href="#external-entity-expansion-local-file">external entity expansion (local file)</a></li>
<li><a class="reference internal" href="#dtd-retrieval">DTD retrieval</a></li>
</ul>
</li>
<li><a class="reference internal" href="#python-xml-libraries">Python XML Libraries</a><ul>
<li><a class="reference internal" href="#settings-in-standard-library">Settings in standard library</a><ul>
<li><a class="reference internal" href="#xml-sax-handler-features">xml.sax.handler Features</a></li>
<li><a class="reference internal" href="#dom-xml-dom-xmlbuilder-options">DOM xml.dom.xmlbuilder.Options</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#defusedxml">defusedxml</a><ul>
<li><a class="reference internal" href="#defusedxml-package">defusedxml (package)</a></li>
<li><a class="reference internal" href="#defusedxml-celementtree">defusedxml.cElementTree</a></li>
<li><a class="reference internal" href="#defusedxml-elementtree">defusedxml.ElementTree</a></li>
<li><a class="reference internal" href="#defusedxml-expatreader">defusedxml.expatreader</a></li>
<li><a class="reference internal" href="#defusedxml-sax">defusedxml.sax</a></li>
<li><a class="reference internal" href="#defusedxml-expatbuilder">defusedxml.expatbuilder</a></li>
<li><a class="reference internal" href="#defusedxml-minidom">defusedxml.minidom</a></li>
<li><a class="reference internal" href="#defusedxml-pulldom">defusedxml.pulldom</a></li>
<li><a class="reference internal" href="#defusedxml-xmlrpc">defusedxml.xmlrpc</a></li>
<li><a class="reference internal" href="#defusedxml-lxml">defusedxml.lxml</a></li>
</ul>
</li>
<li><a class="reference internal" href="#defusedexpat">defusedexpat</a><ul>
<li><a class="reference internal" href="#modifications-in-expat">Modifications in expat</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-avoid-xml-vulnerabilities">How to avoid XML vulnerabilities</a><ul>
<li><a class="reference internal" href="#best-practices">Best practices</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-things-to-consider">Other things to consider</a><ul>
<li><a class="reference internal" href="#attribute-blowup-hash-collision-attack">attribute blowup / hash collision attack</a></li>
<li><a class="reference internal" href="#decompression-bomb">decompression bomb</a></li>
<li><a class="reference internal" href="#processing-instruction">Processing Instruction</a></li>
<li><a class="reference internal" href="#other-dtd-features">Other DTD features</a></li>
<li><a class="reference internal" href="#xpath">XPath</a></li>
<li><a class="reference internal" href="#xpath-injection-attacks">XPath injection attacks</a></li>
<li><a class="reference internal" href="#xinclude">XInclude</a></li>
<li><a class="reference internal" href="#xmlschema-location">XMLSchema location</a></li>
<li><a class="reference internal" href="#xsl-transformation">XSL Transformation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#related-cves">Related CVEs</a></li>
<li><a class="reference internal" href="#other-languages-frameworks">Other languages / frameworks</a><ul>
<li><a class="reference internal" href="#perl">Perl</a></li>
<li><a class="reference internal" href="#ruby">Ruby</a></li>
<li><a class="reference internal" href="#php">PHP</a></li>
<li><a class="reference internal" href="#c-net-mono">C# / .NET / Mono</a></li>
<li><a class="reference internal" href="#java">Java</a></li>
</ul>
</li>
<li><a class="reference internal" href="#todo">TODO</a></li>
<li><a class="reference internal" href="#license">License</a></li>
<li><a class="reference internal" href="#acknowledgements">Acknowledgements</a></li>
<li><a class="reference internal" href="#references">References</a></li>
<li><a class="reference internal" href="#changelog">Changelog</a><ul>
<li><a class="reference internal" href="#defusedxml-0-5-0">defusedxml 0.5.0</a></li>
<li><a class="reference internal" href="#defusedxml-0-5-0-rc1">defusedxml 0.5.0.rc1</a></li>
<li><a class="reference internal" href="#defusedxml-0-4-1">defusedxml 0.4.1</a></li>
<li><a class="reference internal" href="#defusedxml-0-4">defusedxml 0.4</a></li>
<li><a class="reference internal" href="#defusedxml-0-3">defusedxml 0.3</a></li>
<li><a class="reference internal" href="#defusedxml-0-2">defusedxml 0.2</a></li>
<li><a class="reference internal" href="#defusedxml-0-1">defusedxml 0.1</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../../_sources/venv/Lib/site-packages/defusedxml-0.5.0.dist-info/DESCRIPTION.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Howard Li.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../../../../_sources/venv/Lib/site-packages/defusedxml-0.5.0.dist-info/DESCRIPTION.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>